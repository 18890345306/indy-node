

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Setup iptables rules (recommended) &mdash; Hyperledger Indy Node  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Transactions" href="transactions.html" />
    <link rel="prev" title="Dev Setup" href="setup-dev.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Hyperledger Indy Node
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="start-nodes.html">Create a Network and Start Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="add-node.html">Add Node to Existing Pool</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci-cd.html">Continuous Integration / Delivery</a></li>
<li class="toctree-l1"><a class="reference internal" href="cluster-simulation.html">Running a Simulation of a Indy Cluster and Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="helper-scripts.html">Helper Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="indy-file-structure-guideline.html">Indy File Folders Structure Guideline</a></li>
<li class="toctree-l1"><a class="reference internal" href="indy-running-locally.html">Indy – Running the Getting Started tutorial locally</a></li>
<li class="toctree-l1"><a class="reference internal" href="indy-running-locally.html#resetting-the-indy-environment">Resetting the Indy environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-monitoring-tools-for-stewards.html">Node Monitoring Tools for Stewards</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-state-diagnostic-tools.html">Node State Diagnostic Tools Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-state-diagnostic-tools.html#workflow">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="pool-upgrade.html">Pool Upgrade Guideline</a></li>
<li class="toctree-l1"><a class="reference internal" href="requests-new.html">Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup-dev.html">Dev Setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Setup iptables rules (recommended)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-clients-connections-limit">Setting up clients connections limit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-raw-iptables-command-or-iptables-front-end">Using raw iptables command or iptables front-end</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-indy-scripts">Using indy scripts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#for-deb-installation">For deb installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#for-pip-installation">For pip installation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="transactions.html">Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="write-code-guideline.html">Code quality requirements guideline</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.3_to_1.4_migration_guide.html">List of breaking changes for migration from indy-node 1.3 to 1.4</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Hyperledger Indy Node</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Setup iptables rules (recommended)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/setup-iptables.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="setup-iptables-rules-recommended">
<span id="setup-iptables-rules-recommended"></span><h1>Setup iptables rules (recommended)<a class="headerlink" href="#setup-iptables-rules-recommended" title="Permalink to this headline">¶</a></h1>
<p>In order to prevent the indy-node process from reaching of open file descriptors limit caused by clients connections it is strongly
recommended to add iptables rule that limits the number of simultaneous clients connections for client port.</p>
<p>Also iptables can be used to deal with various DoS attacks (e.g. syn flood) but rules’ parameters are not estimated yet.</p>
<p>NOTE: you should be a root to operate with iptables.</p>
<div class="section" id="setting-up-clients-connections-limit">
<span id="setting-up-clients-connections-limit"></span><h2>Setting up clients connections limit<a class="headerlink" href="#setting-up-clients-connections-limit" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-raw-iptables-command-or-iptables-front-end">
<span id="using-raw-iptables-command-or-iptables-front-end"></span><h3>Using raw iptables command or iptables front-end<a class="headerlink" href="#using-raw-iptables-command-or-iptables-front-end" title="Permalink to this headline">¶</a></h3>
<p>In case of deb installation the indy-node environment file /etc/indy/indy.env is created by <code class="docutils literal notranslate"><span class="pre">init_indy_node</span></code> script.
This environment file contains client port (NODE_CLIENT_PORT) and recommended clients connections limit (CLIENT_CONNECTIONS_LIMIT).
This parameters can be used to add the iptables rule for chain INPUT:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># iptables -I INPUT -p tcp --syn --dport 9702 -m connlimit --connlimit-above 15360 --connlimit-mask 0 -j REJECT --reject-with tcp-reset</span>
</pre></div>
</div>
<p>Some key options:</p>
<ul class="simple">
<li>–dport - a port for which limit is set</li>
<li>–connlimit-above - connections limit, exceeding new connections will be rejected using TCP reset</li>
<li>–connlimit-mask - group hosts using the prefix length, 0 means “all subnets”</li>
</ul>
<p>Corresponding fields should be set in case of some iptables front-end usage.</p>
</div>
<div class="section" id="using-indy-scripts">
<span id="using-indy-scripts"></span><h3>Using indy scripts<a class="headerlink" href="#using-indy-scripts" title="Permalink to this headline">¶</a></h3>
<p>For ease of use and for people that are not familiar with iptables we’ve
added two scripts:</p>
<ul class="simple">
<li>setup_iptables: adds a rule to iptables to limit the number of simultaneous
clients connections for specified port;</li>
<li>setup_indy_node_iptables: a wrapper for setup_iptables script which gets client
port and recommended connections limit from indy-node environment file that is created by init_indy_node script.</li>
</ul>
<p>Links to these scripts:</p>
<ul class="simple">
<li>https://github.com/hyperledger/indy-node/blob/master/scripts/setup_iptables</li>
<li>https://github.com/hyperledger/indy-node/blob/master/scripts/setup_indy_node_iptables</li>
</ul>
<p>NOTE: for now the iptables chain for which the rule is added is not parameterized,
the rule is always added for INPUT chain, we can parameterize it in future if needed.</p>
<div class="section" id="for-deb-installation">
<span id="for-deb-installation"></span><h4>For deb installation<a class="headerlink" href="#for-deb-installation" title="Permalink to this headline">¶</a></h4>
<p>To setup the limit of the number of simultaneous clients connections it is enough to run the following script without parameters</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># setup_indy_node_iptables</span>
</pre></div>
</div>
<p>This script gets client port and recommended connections limit from the indy-node environment file.</p>
<p>NOTE: this script should be called <em>after</em> <code class="docutils literal notranslate"><span class="pre">init_indy_node</span></code> script.</p>
</div>
<div class="section" id="for-pip-installation">
<span id="for-pip-installation"></span><h4>For pip installation<a class="headerlink" href="#for-pip-installation" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">setup_indy_node_iptables</span></code> script can not be used in case of pip installation as indy-node environment file does not exist,
use the <code class="docutils literal notranslate"><span class="pre">setup_iptables</span></code> script instead (9702 is a client port, 15360 is recommended limit for now)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># setup_iptables 9702 15360</span>
</pre></div>
</div>
<p>In fact, the <code class="docutils literal notranslate"><span class="pre">setup_indy_node_iptables</span></code> script is just a wrapper for the <code class="docutils literal notranslate"><span class="pre">setup_iptables</span></code> script.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="transactions.html" class="btn btn-neutral float-right" title="Transactions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="setup-dev.html" class="btn btn-neutral" title="Dev Setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Hyperledger

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>