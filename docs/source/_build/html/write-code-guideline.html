

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Code quality requirements guideline &mdash; Hyperledger Indy Node  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="List of breaking changes for migration from indy-node 1.3 to 1.4" href="1.3_to_1.4_migration_guide.html" />
    <link rel="prev" title="Transactions" href="transactions.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Hyperledger Indy Node
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="start-nodes.html">Create a Network and Start Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="add-node.html">Add Node to Existing Pool</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci-cd.html">Continuous Integration / Delivery</a></li>
<li class="toctree-l1"><a class="reference internal" href="cluster-simulation.html">Running a Simulation of a Indy Cluster and Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="helper-scripts.html">Helper Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="indy-file-structure-guideline.html">Indy File Folders Structure Guideline</a></li>
<li class="toctree-l1"><a class="reference internal" href="indy-running-locally.html">Indy – Running the Getting Started tutorial locally</a></li>
<li class="toctree-l1"><a class="reference internal" href="indy-running-locally.html#resetting-the-indy-environment">Resetting the Indy environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-monitoring-tools-for-stewards.html">Node Monitoring Tools for Stewards</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-state-diagnostic-tools.html">Node State Diagnostic Tools Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-state-diagnostic-tools.html#workflow">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="pool-upgrade.html">Pool Upgrade Guideline</a></li>
<li class="toctree-l1"><a class="reference internal" href="requests-new.html">Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup-dev.html">Dev Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup-iptables.html">Setup iptables rules (recommended)</a></li>
<li class="toctree-l1"><a class="reference internal" href="transactions.html">Transactions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Code quality requirements guideline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-items">General items</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-quality-items">Code quality items</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-quality-items">Test quality items</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="1.3_to_1.4_migration_guide.html">List of breaking changes for migration from indy-node 1.3 to 1.4</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Hyperledger Indy Node</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Code quality requirements guideline</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/write-code-guideline.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="code-quality-requirements-guideline">
<span id="code-quality-requirements-guideline"></span><h1>Code quality requirements guideline<a class="headerlink" href="#code-quality-requirements-guideline" title="Permalink to this headline">¶</a></h1>
<p>Please make sure that you take into account the following items before sending a PR with the new code:</p>
<div class="section" id="general-items">
<span id="general-items"></span><h2>General items<a class="headerlink" href="#general-items" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Consider sending a design doc into <code class="docutils literal notranslate"><span class="pre">design</span></code> folder (as markdown or PlantUML diagram) for a new feature  before implementing it.</li>
<li>Make sure that a new feature or fix is covered by tests (try following TDD)</li>
<li>Make sure that documentation is updated according to your changes (see <a class="reference external" href=".">docs</a> folder).
In particular, update <a class="reference internal" href="transactions.html"><span class="doc">transactions</span></a> and <a class="reference internal" href="requests.html"><span class="doc">requests</span></a> if you change any transactions or requests format.</li>
<li>Follow incremental re-factoring approach:<ul>
<li>do not hesitate to improve the code</li>
<li>put TODO and FIXME comments if you see an issue in the code</li>
<li>log tickets in <a class="reference external" href="https://jira.hyperledger.org/secure/RapidBoard.jspa?rapidView=133&amp;projectKey=INDY&amp;view=planning.nodetail">Indy Jira</a> if you see an issue.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="code-quality-items">
<span id="code-quality-items"></span><h2>Code quality items<a class="headerlink" href="#code-quality-items" title="Permalink to this headline">¶</a></h2>
<p>The current code is not perfect, so feel free to improve it.</p>
<ul class="simple">
<li>Follow PEP 8 and keep same code style in all files.<ul>
<li>Naming. Snake case for functions, camel case for classes, etc.</li>
<li>Give names starting with the underscore to class members that are not public by their intention. Don’t use these members outside of the class which they belong to.</li>
<li>Docstrings for all public modules and functions/methods. Pay special attention to describing argument list</li>
<li>Annotate types for arguments of public functions</li>
<li>Annotate return type for public functions</li>
<li>Use flake8 in developer environment and CI (fail a build if the flake8 check does not pass).
(you can run <code class="docutils literal notranslate"><span class="pre">flake8</span> <span class="pre">.</span></code> on the project root to check it; you can install flake8 from pypi: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">flake8</span></code>)</li>
</ul>
</li>
<li>Inheritance and polymorphism<ul>
<li>Use ABC when creating abstract class to ensure that all its fields implemented in successors.</li>
<li>Prefer composition instead of multiple inheritance</li>
<li>Avoid creating deep hierarchies</li>
<li>Avoid type checks (type(instance) == specific_subclass), we have them in some places and it is awful, do polymorphism instead</li>
<li>If there is an interface or abstract class then it should be used everywhere instead of specific instance</li>
<li>Make sure that methods of subclass are fully compatible with their declarations in interface/abstract class</li>
</ul>
</li>
<li>Separation of concerns<ul>
<li>Follow separation of concerns principles</li>
<li>Make components as independent as possible</li>
</ul>
</li>
<li>Avoid high coupling<ul>
<li>Some classes have references to each other, for example Node and Replica, so we get a kind of “spaghetti code</li>
</ul>
</li>
<li>Use classes instead of parallel arrays</li>
<li>Clear and not duplicated Utilities</li>
<li>Decomposition<ul>
<li>There are functions and classes which are too long. For example class Node has more than 2000 lines of code, this complicates understanding of  logic.</li>
<li>This can be solved by destructuring of such classes or functions on a smaller one by aggregation, composition and inheritance</li>
</ul>
</li>
<li>No multiple enclosed if-elif-else statements<ul>
<li>It’s hard to read the code containing multiple enclosed if-else statements</li>
<li>Consider checking some conditions a the beginning of a method and return immediately</li>
</ul>
</li>
<li>Choose good variable and class names<ul>
<li>Make variable and name classes to be clear, especially for Public API</li>
<li>Avoid unclear abbreviations in public API</li>
</ul>
</li>
<li>Use asyncio instead of callbacks<ul>
<li>It  looks and behaves just like a method call - you know that further code is not executed until coroutine completed.</li>
<li>It requires no callback preparation - code is cleaner</li>
<li>It does not break context - exception raised in a coroutine has the same stack trace as an exception raised in a method (while the one raised in callback don’t)</li>
<li>It is easy to chain coroutine calls</li>
<li>If it is needed you can easily wrap coroutine in a Future and execute it in non-blocking fashion</li>
</ul>
</li>
<li>Consider using Actor models (this is our long-term goal for re-factoring to achieve better code quality and performance)</li>
<li>Think about performance of the pool</li>
</ul>
</div>
<div class="section" id="test-quality-items">
<span id="test-quality-items"></span><h2>Test quality items<a class="headerlink" href="#test-quality-items" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Write good tests</p>
<ul class="simple">
<li>Not all of our tests are clean and clear enough</li>
<li>Follow TDD in writing the tests first</li>
<li>Have Unit tests where possible/necessary</li>
<li>Avoid using ‘module’ level fixtures if possible</li>
</ul>
</li>
<li><p class="first">Use indy-sdk in all tests where possible.
If it’s not possible to use indy-sdk for some reasons
(for example, indy-sdk doesn’t have a required feature), then log a ticket in <a class="reference external" href="https://jira.hyperledger.org/secure/RapidBoard.jspa?rapidView=149&amp;projectKey=IS&amp;view=planning.nodetail">Indy-sdk Jira</a>
and put a TODO comment in the test.</p>
</li>
<li><p class="first">Use <code class="docutils literal notranslate"><span class="pre">txnPoolNodeSet</span></code>, not <code class="docutils literal notranslate"><span class="pre">nodeSet</span></code> fixture. <code class="docutils literal notranslate"><span class="pre">nodeSet</span></code> will be deprecated soon.</p>
</li>
<li><p class="first">Importing fixtures</p>
<ul>
<li><p class="first">Fixture imports are not highlighted by IDEs, that’s why they can be accidently removed by someone. To avoid this try to move fixture to conftest of the containing package or conftest of some of higher-level package - this allows fixture to be resolved automatically.
If you still import fixtures, mark such the imports with the following hint for IDE not to mark them as unused and not to remove them when optimizing imports:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">noinspection</span> <span class="pre">PyUnresolvedReferences</span></code></p>
</li>
</ul>
</li>
<li><p class="first">Try to use the same config and file folder structure for integration tests as in real environment.
As of now, all tests follow the same file folder structure (see <a class="reference internal" href="indy-file-structure-guideline.html"><span class="doc">indy-file-structure-guideline</span></a>)
as Indy-node service, but the folders are created inside <code class="docutils literal notranslate"><span class="pre">tmp</span></code> test folder.</p>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="1.3_to_1.4_migration_guide.html" class="btn btn-neutral float-right" title="List of breaking changes for migration from indy-node 1.3 to 1.4" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="transactions.html" class="btn btn-neutral" title="Transactions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Hyperledger

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>